<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Staging</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<link rel="stylesheet" type="text/css" href="../yadadocs.css" />

</head>
<body class="article toc2 toc-left">
<!--
	WARNING !!!!!
	Edit the /YadaDocs/src/docs/asciidoc/common/docinfo-header.html file
	to change this menu.
-->

<select id="navigator">
	<option>Choose chapter...</option>
	<option data-link="./index.html">Index</option>
	<option data-link="./newEclipseProject.html">Getting started</option>
	<option data-link="./examples/bookstoreTutorial.html">Bookstore tutorial</option>
	<option data-link="./internationalization.html">Internationalization</option>
	<option data-link="./database/overview.html">Databases</option>
	<option data-link="./forms/overview.html">Forms</option>
	<option data-link="./ajax.html">Ajax</option>
	<option data-link="./ajaxModal.html">Ajax Modal</option>
	<option data-link="./security/overview.html">Security</option>
	<option data-link="./datatables.html">DataTables</option>
	<option data-link="./emails.html">Sending Emails</option>
	<option data-link="./json.html">Read and Write JSON</option>
	<option data-link="./confirmationModal.html">Confirmation Modal</option>
	<option data-link="./notificationModal.html">Notification Modal</option>
	<option data-link="./misc.html">Miscellaneous</option>
	<option data-link="./staging.html">Staging Docs</option>
	<option data-link="./troubleshooting.html">Troubleshooting</option>
	<option data-link="./upgrade.html">Upgrade Yada Framework Version</option>
</select>
<button id="backToTopButton" onclick="scrollToTop()"><i class="fa fa-arrow-up" aria-hidden="true"></i></button>

<script>
document.querySelector("#navigator").addEventListener("change", function (event) {
	const goup = location.href.lastIndexOf("/") - location.href.lastIndexOf("/en") > 3;
	const link = (goup?"../":"") + this.options[this.selectedIndex].getAttribute("data-link");
	if (link!=null) {
		document.location.href = link;
	}
});

/* Make headers clickable to copy the url */
document.addEventListener('DOMContentLoaded', function () {
    const headers = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

    headers.forEach(header => {
        header.style.cursor = 'pointer';
        header.style.position = 'relative';
        header.addEventListener('click', function(e) {
            const url = window.location.href.split('#')[0] + '#' + this.id;
            window.location.href = url;
            navigator.clipboard.writeText(url);
        });
        header.addEventListener('mouseenter', function() {
            const icon = document.createElement('i');
            icon.className = 'fa fa-clone';
            icon.setAttribute('aria-hidden', 'true');
            icon.style.position = 'absolute';
            icon.style.right = '30px';
            icon.style.top = '50%';
            icon.style.transform = 'translateY(-50%)';
            icon.style.fontSize = '18px';
            icon.style.color = 'gray';
            header.appendChild(icon);
        });
        header.addEventListener('mouseleave', function() {
            const icon = header.querySelector('.fa-clone');
            if (icon) {
            	header.removeChild(icon);
            }
        });
    });
});

function showCopy(e) {
    const icon = document.createElement('i');
    icon.className = 'fa fa-clone';
    icon.setAttribute('aria-hidden', 'true');
    icon.style.position = 'absolute';
    icon.style.left = e.pageX + 'px';
    icon.style.top = e.pageY + 'px';
    icon.style.zIndex = 1000;
    icon.style.fontSize = '24px';
    document.body.appendChild(icon);
    setTimeout(function() {
        document.body.removeChild(icon);
    }, 1000); // 1 second delay
}
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}
/* Only show the backToTopButton when scrolled 200px from the top */
let visible = false;
window.onscroll = function() {
    if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
    	if (!visible) {
	        document.getElementById("backToTopButton").style.display = "block";
	        visible = true;
    	}
    } else {
    	if (visible) {
	        document.getElementById("backToTopButton").style.display = "none";
			visible = false;
    	}
    }
};
</script>
<div id="header">
<h1>Staging</h1>
<div class="details">
<span id="revnumber">version 0.7.7</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_copy_to_clipboard">Copy to clipboard</a></li>
<li><a href="#_lazy_initialization_of_class_attributes">Lazy Initialization of class attributes</a></li>
<li><a href="#_lookup_tables">Lookup Tables</a></li>
<li><a href="#_error_handling">Error Handling</a></li>
<li><a href="#_favicon">Favicon</a></li>
<li><a href="#_document_ready">document ready</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Documentation bits waiting to be moved to the proper section</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_copy_to_clipboard">Copy to clipboard</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML page</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Language</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Javascript</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>yada.copyToClipboard(extendedSelector, event, showFeedback)</code> method copies the content of some page element to the clipboard.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">extendedSelector</dt>
<dd>
<p>the CSS selector eventually with a yada prefix</p>
</dd>
<dt class="hdlist1">event</dt>
<dd>
<p>the event that triggered the copy (usually a click event). Propagation of this event will be stopped.
The event is also used to properly convert any yada prefix on the CSS selector</p>
</dd>
<dt class="hdlist1">showFeedback</dt>
<dd>
<p>whether to show a <a href="ajax.html#_ajax_feedback">feedback message</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following example is a "clone" icon that copies the content of an element with a specific id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;a href="javascript:void(0);"
	th:onclick="|yada.copyToClipboard('#pub-${publication.id}', event, true)|"
	title="Copy to clipboard"&gt;
	&lt;i class="fa fa-clone" aria-hidden="true"&gt;&lt;/i&gt;
&lt;/a&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lazy_initialization_of_class_attributes">Lazy Initialization of class attributes</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backend</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Language</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A common pattern in methods is to check for some attribute to be null and make an
instance otherwise, before using it.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">public void addToMyList(String data) {
	if (this.myList == null) {
		this.myList = new ArrayList();
	}
	this.myList.add(data);
}

public MyThing getMyThing(String somethingToSet) {
	if (this.myThing == null) {
		this.myThing = new MyThing();
	}
	this.myThing.setSomething(somethingToSet);
	return this.myThing;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be made more compact by using <code>YadaUtil.lazyUnsafeInit()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">public void addToMyList(String data) {
	this.myList = YadaUtil.lazyUnsafeInit(this.myList); <i class="conum" data-value="1"></i><b>(1)</b>
	this.myList.add(data);
}

public MyThing getMyThing(String somethingToSet) {
	this.myThing = YadaUtil.lazyUnsafeInit(this.myThing, MyThing::new); <i class="conum" data-value="2"></i><b>(2)</b>
	this.myThing.setSomething(somethingToSet);
	return this.myThing;
}

public MyThing getMyThing(String somethingToSet) {
	this.myThing = YadaUtil.lazyUnsafeInit(this.myThing, () -&gt; new MyThing(this)); <i class="conum" data-value="3"></i><b>(3)</b>
	this.myThing.setSomething(somethingToSet);
	return this.myThing;
}

public void addToMyList(String data) {
	this.myList = YadaUtil.lazyUnsafeInit(this.myList, ArrayList::new); <i class="conum" data-value="4"></i><b>(4)</b>
	this.myList.add(data);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initializing a list with a simple api</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initializing an object with a constructor without arguments</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Initializing an object with a constructor with arguments</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Initializing an object with a constructor with arguments</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
In a multithreaded scenario there may be race conditions with unpredictable results. This is why the method is called "lazyUnsafeInit".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are of course no race conditions if the attribute owner instance is itself guaranteed to ever be
used by one thread only, for example when the owner instance is created
inside some method (i.e. is not a singleton),
because each thread will have its own stack and its own instance of local variables.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">public class MyOwner {
	public SomeAttribute someAttribute;
}

public class MyProcessor {
	MyOwner mySingletonOwner = new MyOwner();

	public SomeAttribute process() {
		// THREAD SAFE
		MyOwner myOwner = new MyOwner();
		myOwner.someAttribute = YadaUtil.lazyUnsafeInit(myOwner.someAttribute, SomeAttribute::new); <i class="conum" data-value="1"></i><b>(1)</b>
		// NOT THREAD SAFE
		mySingletonOwner.someAttribute = YadaUtil.lazyUnsafeInit(myOwner.someAttribute, SomeAttribute::new); <i class="conum" data-value="2"></i><b>(2)</b>
		return mySingletonOwner.someAttribute; <i class="conum" data-value="3"></i><b>(3)</b>
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is always going to work properly because each thread entering the process() method has its own instance of MyOwner</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is prone to race conditions if two threads enter the process() method because they would
operate on the same instance of MyOwner but probably with their own copy of mySingletonOwner.someAttribute</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This is	going to be a problem later in the execution if each thread has its own copy of mySingletonOwner.someAttribute</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In a multithreaded scenario, lazy initialization involves the use of volatile attributes and synchronization, so better
avoid it when possible.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lookup_tables">Lookup Tables</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backend</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Language</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A lookup table holds a value indexed by some other values. It is a generalisation
of a Map where a single key indexes a value: in a lookup table the key can be a collection of many values.
A simple implementation would be to concatenate the many keys into a single string to be
used as a key in a Map, or to use some key object that holds many values.</p>
</div>
<div class="paragraph">
<p>A much better solution is to use the YadaLookupTable class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">YadaLookupTable&lt;Integer, String&gt; lookupTable = new YadaLookupTable&lt;&gt;();
lookupTable.put("value1", 1, 2, 3);
lookupTable.put("value2", 1, 2, 4);
...
lookupTable.get(1, 2, 3); // "value1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The keys must all be of the same type, that can be different from the type of the value.
In order to overcome this limitation, just use "Object" so that keys can be of mixed types.</p>
</div>
<div class="paragraph">
<p>For a better control on the key types, four other classes are provided:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">YadaLookupTableThree</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table with 3 columns: two keys as index for one value</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">YadaLookupTableFour</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table with 4 columns: three keys as index for one value</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">YadaLookupTableFive</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table with 5 columns: four keys as index for one value</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">YadaLookupTableSix</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table with 6 columns: five keys as index for one value</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">YadaLookupTableThree&lt;Locale, Integer, String&gt; lookupTable = new YadaLookupTableThree&lt;&gt;();
lookupTable.put(Locale.EN, 1, "Hello");
lookupTable.put(Locale.IT, 1, "Ciao");
...
lookupTable.get(Locale.EN, 1); // "Hello"</code></pre>
</div>
</div>
<div class="paragraph">
<p>All implementations are efficient and thread safe.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_handling">Error Handling</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration, HTML page</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Language</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML, HTML</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>An error can be generated either outside the application (e.g. an endpoint doesn&#8217;t exist,
a thymeleaf template is not found) or
inside the application via an Exception.
The first kind of error is handled by providing an error page in the <code>web.xml</code> file. The default
target is <code>/yadaError</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;error-page&gt;
	&lt;location&gt;/yadaError&lt;/location&gt;
&lt;/error-page&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second kind of error is handled by <code>YadaGlobalExceptionHandler</code>.</p>
</div>
<div class="paragraph">
<p>These are two very distinct types or errors but the user
doesn&#8217;t need to be aware of the difference.
For both kinds of errors, an ajax request results in the contents of <code>ajaxError.html</code>;
for normal requests, the error details are set in some model attributes,
then execution is forwarded to the <code>@RequestMapping</code> configured with <code>&lt;errorPageForward&gt;</code>.
By default the target is the home page, where an error modal is shown.
To show a dedicated error page, a skeleton of which can be found in <code>errorPage.html</code>,
configure it as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">&lt;paths&gt;
	&lt;errorPageForward&gt;/errorPage&lt;/errorPageForward&gt;
&lt;/paths&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A dedicated error page is generally more robust because it better handles errors generated in
the home page itself
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The global exception handler does not process exceptions annotated with <code>@ResponseStatus</code> so
that Spring can handle them as expected
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A very quick way to respond to a request with some HTTP error code (e.g. 404 "NOT FOUND") is to
throw a <code>RuntimeException</code> annotated with <code>@ResponseStatus</code>. For example <code>YadaHttpNotFoundException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">@ResponseStatus(value=HttpStatus.NOT_FOUND)  // 404
public class YadaHttpNotFoundException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>TODO: implement other HTTP error exceptions</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_favicon">Favicon</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML page</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Language</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Browsers load the "/favicon.ico" url by default when nothing else has been
specified in the HTML page or even when loading non-HTML pages, where the favicon location can&#8217;t be
specified. It is therefore important to provide a valid response when this happens.
The "/favicon.ico" URL is handled by Yada Framework as long as a <code>favicon.ico</code> file is provided
in the <code>webapp</code> folder.</p>
</div>
<div class="paragraph">
<p>Other versions of the favicon can be specified in the header. It is good practice to put them in
a versioned folder so that it will be easier to bypass the browser cache in case the icons will be
changed at a later date. The skeleton application has the following line in the header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;link rel="icon" type="image/x-icon" th:href="@{/static/favicons-1.0/favicon.ico}"&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_document_ready">document ready</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML page</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Language</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">javascript</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Executing some javascript after the document has been fully loaded requires some lines of code that
check the state of the document and register an event handler. This has already been implemented
and inserted in the <code>header.html</code> file by the <a href="newEclipseProject.html#_code_generation_just_a_bit">yadaInit</a> task
used to create the initial project skeleton.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">&lt;script th:fragment="yexready"&gt;
	window.yex = window.yex || {};
	yex.ready = yex.ready || function (fn) {
		if (document.readyState != 'loading'){
			fn();
		} else {
			document.addEventListener('DOMContentLoaded', fn);
		}
	}
&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be used anywhere in all site pages that include it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">&lt;script&gt;
	yex.ready(function(){
		// do something on the fully loaded page
	});
&lt;/script&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.7.7<br>
Last updated 2025-08-07 10:44:57 +0200
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>